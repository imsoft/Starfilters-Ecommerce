---
import WebsiteLayout from "@/layouts/websiteLayout.astro";
import SEO from "@/components/shared/SEO.astro";
import LazyImage from "@/components/shared/LazyImage.astro";
import { getActiveCategories } from "@/lib/filter-category-service";
import { getProductPlaceholderImage } from "@/lib/image-utils";
import { generateBreadcrumbSchema } from "@/lib/seo-utils";
import { getLangFromUrl, useTranslations } from "@/i18n/utils";
import { getCategoryName, getCategoryDescription } from "@/lib/i18n-helpers";

export const prerender = false;

// Detectar idioma actual
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
// Por ahora usar /productos para ambos idiomas hasta que se cree /en/products
// El par√°metro filter_category_id funcionar√° igual en ambos casos
const productsRoute = '/productos';

// Obtener categor√≠as activas
let filterCategories: any[] = [];

try {
  filterCategories = await getActiveCategories();
  console.log(`üì¶ P√°gina /filtros: ${filterCategories.length} categor√≠as activas encontradas`);
  
  // Log para debugging
  if (filterCategories.length === 0) {
    console.warn('‚ö†Ô∏è No se encontraron categor√≠as activas. Verifica que existan categor√≠as con status="active" o status IS NULL en la base de datos.');
  } else {
    console.log('‚úÖ Categor√≠as encontradas:', filterCategories.map(c => ({ id: c.id, name: c.name, status: c.status })));
  }
} catch (error) {
  console.error('‚ùå Error en p√°gina /filtros:', error);
  filterCategories = [];
}

// Generar datos SEO
const siteUrl = Astro.site?.href || Astro.url.origin;
const breadcrumbSchema = generateBreadcrumbSchema([
  { name: 'Inicio', url: siteUrl },
  { name: 'Filtros de Aire', url: `${siteUrl}/filtros` }
]);
---

<WebsiteLayout 
  title="Filtros de Aire"
  seoTitle="Filtros de Aire - Cat√°logo Star Filters"
  description="Explora nuestro cat√°logo completo de filtros de aire. Productos de alta calidad con env√≠o a toda la Rep√∫blica Mexicana."
  keywords={[
    'filtros de aire',
    'comprar filtros de aire',
    'filtros industriales',
    'tienda filtros M√©xico'
  ]}
>
  <SEO 
    slot="seo"
    title="Filtros de Aire"
    description="Explora nuestro cat√°logo completo de filtros de aire. Productos de alta calidad con env√≠o a toda la Rep√∫blica Mexicana."
    ogType="website"
    keywords={[
      'filtros de aire',
      'comprar filtros de aire',
      'filtros industriales'
    ]}
  />
  
  <!-- Breadcrumb Schema -->
  <script slot="seo" type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
  
  <div class="bg-background py-24">
    <!-- Breadcrumb -->
    <div class="mx-auto max-w-xl px-4 sm:px-6 lg:max-w-7xl lg:px-8">
      <nav class="mb-8" aria-label="Breadcrumb">
        <ol class="flex items-center space-x-2 text-sm text-muted-foreground">
          <li>
            <a href="/" class="hover:text-foreground transition-colors">Inicio</a>
          </li>
          <li>
            <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
            </svg>
          </li>
          <li class="text-foreground font-medium">Filtros de Aire</li>
        </ol>
      </nav>
    </div>

    <section
      aria-labelledby="collection-heading"
      class="mx-auto max-w-xl px-4 sm:px-6 lg:max-w-7xl lg:px-8"
    >
      <div class="mb-12">
        <h1
          id="collection-heading"
          class="text-3xl font-bold tracking-tight text-foreground sm:text-4xl"
        >
          Filtros de Aire
        </h1>
        <p class="mt-4 text-lg text-muted-foreground">
          En Star Filters fabricamos filtros de aire dise√±ados para cumplir con los est√°ndares m√°s exigentes de la industria farmac√©utica, electr√≥nica y de manufactura avanzada. Cada tipo de filtro ofrece un nivel de protecci√≥n y eficiencia adaptado a tu proceso productivo:
        </p>
      </div>

      <!-- Grid de categor√≠as -->
      <div class="grid grid-cols-1 gap-x-6 gap-y-10 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 xl:gap-x-8" id="categories-grid">
        {filterCategories.map((category) => {
          const imageUrl = category.main_image || getProductPlaceholderImage('filtros');
          return (
            <a
              href={`${productsRoute}?category=${category.slug}`}
              class="group category-card relative flex flex-col cursor-pointer transition-transform hover:scale-105"
              data-name={category.name.toLowerCase()}
            >
              <div class="w-full h-80 overflow-hidden rounded-lg bg-muted shadow-md">
                <LazyImage
                  src={imageUrl}
                  alt={category.name}
                  class="h-full w-full object-cover object-center group-hover:opacity-75 transition-opacity"
                />
              </div>
              <h3 class="mt-4 text-lg text-foreground font-semibold group-hover:text-primary transition-colors">
                {getCategoryName(category, lang)}
              </h3>
              {getCategoryDescription(category, lang) && (
                <p class="mt-2 text-sm text-muted-foreground line-clamp-3">
                  {getCategoryDescription(category, lang)}
                </p>
              )}
              <div class="mt-auto pt-4">
                <span class="inline-flex items-center text-sm font-medium text-primary group-hover:text-primary/80 transition-colors">
                  Ver productos
                  <svg class="ml-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                  </svg>
                </span>
              </div>
            </a>
          );
        })}
      </div>

      {filterCategories.length === 0 && (
        <div class="text-center py-12">
          <h3 class="text-lg font-medium text-foreground">
            No hay categor√≠as disponibles
          </h3>
          <p class="mt-2 text-sm text-muted-foreground">
            Vuelve pronto para ver nuevas categor√≠as de filtros
          </p>
        </div>
      )}
    </section>

    <!-- ¬øPor qu√© Star Filters? -->
    <div class="mx-auto max-w-6xl px-4 mt-24 sm:px-6 lg:px-8">
      <h2 class="mb-10 text-center text-3xl font-semibold tracking-tight text-balance text-foreground sm:text-4xl">
        {t('filters.whyStarFilters.title')}
      </h2>
      <div class="mb-16 grid grid-cols-2 gap-x-6 gap-y-10 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-7 lg:gap-x-4">
        <div class="group flex cursor-default flex-col items-center text-center transition-colors">
          <img src="/images/category-filters/iconos filtros-01.png" alt="" class="h-14 w-14 object-contain sm:h-16 sm:w-16" width="64" height="64" loading="lazy" />
          <span class="mt-3 text-sm font-medium text-foreground transition-colors group-hover:text-primary">{t('filters.whyStarFilters.benefit1')}</span>
        </div>
        <div class="group flex cursor-default flex-col items-center text-center transition-colors">
          <img src="/images/category-filters/iconos filtros-02.png" alt="" class="h-14 w-14 object-contain sm:h-16 sm:w-16" width="64" height="64" loading="lazy" />
          <span class="mt-3 text-sm font-medium text-foreground transition-colors group-hover:text-primary">{t('filters.whyStarFilters.benefit2')}</span>
        </div>
        <div class="group flex cursor-default flex-col items-center text-center transition-colors">
          <img src="/images/category-filters/iconos filtros-03.png" alt="" class="h-14 w-14 object-contain sm:h-16 sm:w-16" width="64" height="64" loading="lazy" />
          <span class="mt-3 text-sm font-medium text-foreground transition-colors group-hover:text-primary">{t('filters.whyStarFilters.benefit3')}</span>
        </div>
        <div class="group flex cursor-default flex-col items-center text-center transition-colors">
          <img src="/images/category-filters/iconos filtros-04.png" alt="" class="h-14 w-14 object-contain sm:h-16 sm:w-16" width="64" height="64" loading="lazy" />
          <span class="mt-3 text-sm font-medium text-foreground transition-colors group-hover:text-primary">{t('filters.whyStarFilters.benefit4')}</span>
        </div>
        <div class="group flex cursor-default flex-col items-center text-center transition-colors">
          <img src="/images/category-filters/iconos filtros-05.png" alt="" class="h-14 w-14 object-contain sm:h-16 sm:w-16" width="64" height="64" loading="lazy" />
          <span class="mt-3 text-sm font-medium text-foreground transition-colors group-hover:text-primary">{t('filters.whyStarFilters.benefit5')}</span>
        </div>
        <div class="group flex cursor-default flex-col items-center text-center transition-colors">
          <img src="/images/category-filters/iconos filtros-06.png" alt="" class="h-14 w-14 object-contain sm:h-16 sm:w-16" width="64" height="64" loading="lazy" />
          <span class="mt-3 text-sm font-medium text-foreground transition-colors group-hover:text-primary">{t('filters.whyStarFilters.benefit6')}</span>
        </div>
        <div class="group flex cursor-default flex-col items-center text-center transition-colors">
          <img src="/images/category-filters/iconos filtros-07.png" alt="" class="h-14 w-14 object-contain sm:h-16 sm:w-16" width="64" height="64" loading="lazy" />
          <span class="mt-3 text-sm font-medium text-foreground transition-colors group-hover:text-primary">{t('filters.whyStarFilters.benefit7')}</span>
        </div>
      </div>
    </div>
  </div>
</WebsiteLayout>

