---
export interface Props {
  title: string;
  description: string;
  canonical?: string;
  ogType?: 'website' | 'article' | 'product';
  ogImage?: string;
  ogImageAlt?: string;
  article?: {
    publishedTime?: string;
    modifiedTime?: string;
    author?: string;
    tags?: string[];
  };
  product?: {
    price?: number;
    currency?: string;
    availability?: 'in stock' | 'out of stock';
    brand?: string;
  };
  noindex?: boolean;
  nofollow?: boolean;
  keywords?: string[];
  alternateLanguages?: Array<{ lang: string; url: string }>;
}

const {
  title,
  description,
  canonical,
  ogType = 'website',
  ogImage,
  ogImageAlt,
  article,
  product,
  noindex = false,
  nofollow = false,
  keywords = [],
  alternateLanguages = []
} = Astro.props;

// URL base del sitio
const siteUrl = Astro.site || new URL(Astro.url.origin);
const currentUrl = new URL(Astro.url.pathname, siteUrl);
const canonicalUrl = canonical || currentUrl.href;

// Imagen por defecto
const defaultOgImage = new URL('/logos/logo-starfilters.png', siteUrl).href;
const ogImageUrl = ogImage || defaultOgImage;

// Título completo con marca
const fullTitle = `${title} | Star Filters`;

// Robots meta
const robotsContent = `${noindex ? 'noindex' : 'index'}, ${nofollow ? 'nofollow' : 'follow'}`;

// Keywords del sitio
const siteKeywords = [
  'Star Filters',
  'filtros industriales',
  'cuartos limpios',
  'filtros HEPA',
  'purificación de aire',
  'filtros México',
  ...keywords
];
---

<!-- Meta tags básicos -->
<title>{fullTitle}</title>
<meta name="description" content={description} />
<meta name="keywords" content={siteKeywords.join(', ')} />
<link rel="canonical" href={canonicalUrl} />

<!-- Hreflang tags para i18n -->
{alternateLanguages.length > 0 && alternateLanguages.map(alt => (
  <link rel="alternate" hreflang={alt.lang} href={alt.url} />
))}

<!-- Robots -->
<meta name="robots" content={robotsContent} />
<meta name="googlebot" content={robotsContent} />

<!-- Open Graph / Facebook -->
<meta property="og:type" content={ogType} />
<meta property="og:url" content={canonicalUrl} />
<meta property="og:title" content={fullTitle} />
<meta property="og:description" content={description} />
<meta property="og:image" content={ogImageUrl} />
{ogImageAlt && <meta property="og:image:alt" content={ogImageAlt} />}
<meta property="og:site_name" content="Star Filters" />
<meta property="og:locale" content="es_MX" />
<meta property="og:locale:alternate" content="en_US" />
{alternateLanguages.length > 0 && alternateLanguages.map(alt => (
  <meta property="og:locale:alternate" content={alt.lang === 'en' ? 'en_US' : alt.lang} />
))}

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:url" content={canonicalUrl} />
<meta name="twitter:title" content={fullTitle} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={ogImageUrl} />
{ogImageAlt && <meta name="twitter:image:alt" content={ogImageAlt} />}

<!-- Article specific (para blog) -->
{article && (
  <>
    {article.publishedTime && <meta property="article:published_time" content={article.publishedTime} />}
    {article.modifiedTime && <meta property="article:modified_time" content={article.modifiedTime} />}
    {article.author && <meta property="article:author" content={article.author} />}
    {article.tags && article.tags.map(tag => (
      <meta property="article:tag" content={tag} />
    ))}
  </>
)}

<!-- Product specific (para productos) -->
{product && (
  <>
    {product.price && (
      <>
        <meta property="product:price:amount" content={product.price.toString()} />
        <meta property="product:price:currency" content={product.currency || 'MXN'} />
      </>
    )}
    {product.availability && <meta property="product:availability" content={product.availability} />}
    {product.brand && <meta property="product:brand" content={product.brand} />}
  </>
)}

<!-- Additional SEO tags -->
<meta name="author" content="Star Filters" />
<meta name="language" content="Spanish" />
<meta name="revisit-after" content="7 days" />
<meta name="rating" content="general" />

<!-- Geo tags -->
<meta name="geo.region" content="MX" />
<meta name="geo.placename" content="México" />

<!-- Mobile -->
<meta name="mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<meta name="apple-mobile-web-app-title" content="Star Filters" />

<!-- Schema.org JSON-LD -->
<script type="application/ld+json" set:html={JSON.stringify({
  "@context": "https://schema.org",
  "@type": ogType === 'article' ? 'Article' : ogType === 'product' ? 'Product' : 'WebPage',
  "name": title,
  "description": description,
  "url": canonicalUrl,
  "image": ogImageUrl,
  ...(article && {
    "datePublished": article.publishedTime,
    "dateModified": article.modifiedTime,
    "author": {
      "@type": "Person",
      "name": article.author || "Star Filters"
    }
  }),
  ...(product && {
    "offers": {
      "@type": "Offer",
      "price": product.price,
      "priceCurrency": product.currency || "MXN",
      "availability": product.availability === 'in stock' 
        ? "https://schema.org/InStock" 
        : "https://schema.org/OutOfStock"
    },
    "brand": {
      "@type": "Brand",
      "name": product.brand || "Star Filters"
    }
  })
})} />

