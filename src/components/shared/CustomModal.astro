---
interface Props {
  id: string;
}

const { id } = Astro.props;
---

<!-- Modal personalizado -->
<div
  id={id}
  class="fixed inset-0 z-50 hidden items-center justify-center"
  style="display: none;"
>
  <!-- Overlay -->
  <div
    id={`${id}-overlay`}
    class="fixed inset-0 bg-black/50"
    style="z-index: 9998;"
  ></div>
  
  <!-- Modal Content -->
  <div
    id={`${id}-content`}
    class="relative z-50 mx-4 rounded-lg bg-white p-6 shadow-xl"
    style="z-index: 10000; position: relative; max-width: 28rem; width: auto; min-width: 20rem;"
  >
    <div style="display: flex; flex-direction: column; gap: 1rem;">
      <h2
        id={`${id}-title`}
        class="text-lg font-semibold text-gray-900"
        style="margin: 0; padding: 0;"
      ></h2>
      <p
        id={`${id}-description`}
        class="text-sm text-gray-600"
        style="margin: 0; padding: 0;"
      ></p>
      <div
        style="display: flex; flex-direction: row; justify-content: flex-end; gap: 0.75rem; margin-top: 1.5rem;"
      >
        <button
          id={`${id}-cancel`}
          type="button"
          style="display: inline-flex; align-items: center; justify-content: center; padding: 0.5rem 1rem; font-size: 0.875rem; font-weight: 500; color: #374151; background-color: #ffffff; border: 1px solid #d1d5db; border-radius: 0.375rem; cursor: pointer; transition: all 0.2s;"
        >
          Cancelar
        </button>
        <button
          id={`${id}-confirm`}
          type="button"
          style="display: inline-flex; align-items: center; justify-content: center; padding: 0.5rem 1rem; font-size: 0.875rem; font-weight: 500; color: #ffffff; background-color: #dc2626; border: none; border-radius: 0.375rem; cursor: pointer; transition: all 0.2s;"
        >
          Eliminar
        </button>
      </div>
    </div>
  </div>
</div>

<script is:inline>
  // Funci√≥n global para mostrar el modal personalizado (solo se define una vez)
  (function() {
    if (typeof window === "undefined") return;
    
    // Solo definir la funci√≥n si no existe
    if ((window as any).showCustomModal) return;
    
    (window as any).showCustomModal = function(
      modalId: string,
      title: string,
      description: string,
      onConfirm: () => void,
      confirmText: string = "Confirmar",
      cancelText: string = "Cancelar"
    ): void {
      console.log('üîç Mostrando modal:', modalId);
      const modal = document.getElementById(modalId);
      const modalTitle = document.getElementById(modalId + '-title');
      const modalDescription = document.getElementById(modalId + '-description');
      const confirmBtn = document.getElementById(modalId + '-confirm');
      const cancelBtn = document.getElementById(modalId + '-cancel');
      const overlay = document.getElementById(modalId + '-overlay');

      console.log('üîç Elementos encontrados:', {
        modal: !!modal,
        modalTitle: !!modalTitle,
        modalDescription: !!modalDescription,
        confirmBtn: !!confirmBtn,
        cancelBtn: !!cancelBtn,
        overlay: !!overlay
      });

      if (!modal || !modalTitle || !modalDescription || !confirmBtn || !cancelBtn) {
        console.error('‚ùå No se encontraron todos los elementos del modal');
        return;
      }

      // Establecer contenido
      modalTitle.textContent = title;
      modalDescription.textContent = description;
      confirmBtn.textContent = confirmText;
      cancelBtn.textContent = cancelText;

      // Mostrar modal
      modal.style.display = "flex";
      document.body.style.overflow = "hidden";
      console.log('‚úÖ Modal mostrado');

      // Handlers
      const handleConfirm = () => {
        console.log('‚úÖ Confirmado');
        onConfirm();
        closeModal();
      };

      const handleCancel = () => {
        console.log('‚ùå Cancelado');
        closeModal();
      };

      const closeModal = () => {
        modal.style.display = "none";
        document.body.style.overflow = "";
        // Remover listeners clonando los elementos
        const newConfirmBtn = confirmBtn.cloneNode(true) as HTMLButtonElement;
        const newCancelBtn = cancelBtn.cloneNode(true) as HTMLButtonElement;
        const newOverlay = overlay?.cloneNode(true) as HTMLDivElement;
        
        confirmBtn.replaceWith(newConfirmBtn);
        cancelBtn.replaceWith(newCancelBtn);
        if (overlay) overlay.replaceWith(newOverlay);
      };

      // Agregar listeners a los elementos actuales
      confirmBtn.addEventListener("click", handleConfirm);
      cancelBtn.addEventListener("click", handleCancel);
      if (overlay) overlay.addEventListener("click", handleCancel);

      // Cerrar con ESC
      const handleEscape = (e: KeyboardEvent) => {
        if (e.key === "Escape") {
          handleCancel();
          document.removeEventListener("keydown", handleEscape);
        }
      };
      document.addEventListener("keydown", handleEscape);
    };
    console.log('‚úÖ Funci√≥n showCustomModal definida globalmente');
  })();
</script>

<style is:global>
  /* Estilos globales para modales personalizados */
  [id^="confirm-dialog"]:not(.hidden),
  [id="status-dialog"]:not(.hidden) {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    z-index: 9999 !important;
    margin: 0 !important;
    padding: 0 !important;
  }
  
  [id^="confirm-dialog"].hidden,
  [id="status-dialog"].hidden {
    display: none !important;
  }
  
  /* Overlay oscuro */
  [id^="confirm-dialog"] [id$="-overlay"],
  [id="status-dialog"] [id$="-overlay"] {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    z-index: 9998 !important;
    background-color: rgba(0, 0, 0, 0.5) !important;
  }
  
  /* Contenido del modal */
  [id^="confirm-dialog"] [id$="-content"],
  [id="status-dialog"] [id$="-content"] {
    position: relative !important;
    z-index: 10000 !important;
    background-color: #ffffff !important;
    border-radius: 0.5rem !important;
    padding: 1.5rem !important;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04) !important;
    max-width: 28rem !important;
    width: auto !important;
    min-width: 20rem !important;
    margin: 0 auto !important;
    display: block !important;
    visibility: visible !important;
    box-sizing: border-box !important;
    overflow: visible !important;
  }
  
  /* Contenedor interno del modal */
  [id^="confirm-dialog"] [id$="-content"] > div,
  [id="status-dialog"] [id$="-content"] > div {
    display: flex !important;
    flex-direction: column !important;
    gap: 1rem !important;
    width: 100% !important;
    box-sizing: border-box !important;
  }
  
  /* T√≠tulo del modal */
  [id^="confirm-dialog"] [id$="-title"],
  [id="status-dialog"] [id$="-title"] {
    color: #111827 !important;
    font-size: 1.125rem !important;
    font-weight: 600 !important;
    line-height: 1.5rem !important;
    margin: 0 !important;
    margin-bottom: 0.5rem !important;
  }
  
  /* Descripci√≥n del modal */
  [id^="confirm-dialog"] [id$="-description"],
  [id="status-dialog"] [id$="-description"] {
    color: #4b5563 !important;
    font-size: 0.875rem !important;
    line-height: 1.25rem !important;
    margin: 0 !important;
  }
  
  /* Botones del modal */
  [id^="confirm-dialog"] [id$="-cancel"],
  [id="status-dialog"] [id$="-cancel"] {
    background-color: #ffffff !important;
    color: #374151 !important;
    border: 1px solid #d1d5db !important;
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    padding: 0.5rem 1rem !important;
    font-size: 0.875rem !important;
    font-weight: 500 !important;
    border-radius: 0.375rem !important;
    cursor: pointer !important;
    transition: all 0.2s !important;
  }
  
  [id^="confirm-dialog"] [id$="-cancel"]:hover,
  [id="status-dialog"] [id$="-cancel"]:hover {
    background-color: #f9fafb !important;
  }
  
  [id^="confirm-dialog"] [id$="-confirm"],
  [id="status-dialog"] [id$="-confirm"] {
    background-color: #dc2626 !important;
    color: #ffffff !important;
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    padding: 0.5rem 1rem !important;
    font-size: 0.875rem !important;
    font-weight: 500 !important;
    border-radius: 0.375rem !important;
    border: none !important;
    cursor: pointer !important;
    transition: all 0.2s !important;
  }
  
  [id^="confirm-dialog"] [id$="-confirm"]:hover,
  [id="status-dialog"] [id$="-confirm"]:hover {
    background-color: #b91c1c !important;
  }
  
  /* Contenedor de botones */
  [id^="confirm-dialog"] [id$="-content"] > div > div:last-child,
  [id="status-dialog"] [id$="-content"] > div > div:last-child {
    display: flex !important;
    flex-direction: row !important;
    justify-content: flex-end !important;
    align-items: center !important;
    gap: 0.75rem !important;
    margin-top: 1.5rem !important;
    width: 100% !important;
    box-sizing: border-box !important;
  }
  
  /* Asegurar que los botones no se expandan */
  [id^="confirm-dialog"] [id$="-cancel"],
  [id^="confirm-dialog"] [id$="-confirm"],
  [id="status-dialog"] [id$="-cancel"],
  [id="status-dialog"] [id$="-confirm"] {
    flex-shrink: 0 !important;
    flex-grow: 0 !important;
    width: auto !important;
    min-width: auto !important;
    max-width: none !important;
    height: auto !important;
    min-height: auto !important;
    max-height: none !important;
  }
  
  /* Asegurar que el t√≠tulo y descripci√≥n sean visibles */
  [id^="confirm-dialog"] [id$="-title"],
  [id^="confirm-dialog"] [id$="-description"],
  [id="status-dialog"] [id$="-title"],
  [id="status-dialog"] [id$="-description"] {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    width: 100% !important;
    box-sizing: border-box !important;
  }
</style>

