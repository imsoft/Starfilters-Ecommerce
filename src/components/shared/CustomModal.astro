---
interface Props {
  id: string;
}

const { id } = Astro.props;
---

<!-- Modal personalizado -->
<div
  id={id}
  class="fixed inset-0 z-50 hidden items-center justify-center"
  style="display: none;"
>
  <!-- Overlay -->
  <div
    id={`${id}-overlay`}
    class="fixed inset-0 bg-black/80 backdrop-blur-sm"
  ></div>
  
  <!-- Modal Content -->
  <div
    id={`${id}-content`}
    class="relative z-50 mx-4 w-full max-w-md rounded-lg border border-border bg-background p-6 shadow-lg"
  >
    <div class="space-y-4">
      <h2
        id={`${id}-title`}
        class="text-lg font-semibold text-foreground"
      ></h2>
      <p
        id={`${id}-description`}
        class="text-sm text-muted-foreground"
      ></p>
      <div
        class="flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2 gap-2"
      >
        <button
          id={`${id}-cancel`}
          class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"
        >
          Cancelar
        </button>
        <button
          id={`${id}-confirm`}
          class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-red-600 text-white hover:bg-red-700 h-10 px-4 py-2"
        >
          Confirmar
        </button>
      </div>
    </div>
  </div>
</div>

<script define:vars={{ modalId: id }}>
  // Función global para mostrar el modal personalizado
  function showCustomModal(
    modalId: string,
    title: string,
    description: string,
    onConfirm: () => void,
    confirmText: string = "Confirmar",
    cancelText: string = "Cancelar"
  ): void {
    const modal = document.getElementById(modalId);
    const modalTitle = document.getElementById(`${modalId}-title`);
    const modalDescription = document.getElementById(`${modalId}-description`);
    const confirmBtn = document.getElementById(`${modalId}-confirm`);
    const cancelBtn = document.getElementById(`${modalId}-cancel`);
    const overlay = document.getElementById(`${modalId}-overlay`);

    if (!modal || !modalTitle || !modalDescription || !confirmBtn || !cancelBtn) return;

    // Establecer contenido
    modalTitle.textContent = title;
    modalDescription.textContent = description;
    confirmBtn.textContent = confirmText;
    cancelBtn.textContent = cancelText;

    // Mostrar modal
    modal.style.display = "flex";
    document.body.style.overflow = "hidden";

    // Handlers
    const handleConfirm = () => {
      onConfirm();
      closeModal();
    };

    const handleCancel = () => {
      closeModal();
    };

    const closeModal = () => {
      modal.style.display = "none";
      document.body.style.overflow = "";
      // Remover listeners
      const newConfirmBtn = confirmBtn.cloneNode(true) as HTMLButtonElement;
      const newCancelBtn = cancelBtn.cloneNode(true) as HTMLButtonElement;
      const newOverlay = overlay?.cloneNode(true) as HTMLDivElement;
      
      confirmBtn.replaceWith(newConfirmBtn);
      cancelBtn.replaceWith(newCancelBtn);
      if (overlay) overlay.replaceWith(newOverlay);
    };

    // Agregar listeners a los nuevos elementos
    const newConfirmBtn = document.getElementById(`${modalId}-confirm`);
    const newCancelBtn = document.getElementById(`${modalId}-cancel`);
    const newOverlay = document.getElementById(`${modalId}-overlay`);

    newConfirmBtn?.addEventListener("click", handleConfirm);
    newCancelBtn?.addEventListener("click", handleCancel);
    newOverlay?.addEventListener("click", handleCancel);

    // Cerrar con ESC
    const handleEscape = (e: KeyboardEvent) => {
      if (e.key === "Escape") {
        handleCancel();
        document.removeEventListener("keydown", handleEscape);
      }
    };
    document.addEventListener("keydown", handleEscape);
  }

  // Hacer función global
  if (typeof window !== "undefined") {
    (window as any).showCustomModal = showCustomModal;
  }
</script>

<style is:global>
  /* Estilos globales para modales personalizados */
  [id^="confirm-dialog"] {
    display: none;
    align-items: center;
    justify-content: center;
  }
  
  [id^="confirm-dialog"][style*="display: flex"] {
    display: flex !important;
  }
</style>

